import shared from "../../../../../../core-files/shared";
import { pollerLite } from "../../../../../../lib/utils";
import TestReporting from "../../boots_tracking/TestReporting";

const { ID, VARIATION } = shared;

const testID = `${ID}|BLTV001 - Prompt to Login`; // Change this to test name and include in experiment.js
const testVariant = `${VARIATION === 'control' ? 'Control' : `V${VARIATION}`}`;

const plpPage = (id) => {
    const plpBanner = `<div class="${id}__plp-banner ${id}__advantageCardContainer oct-grid__cell oct-grid__cell--width-3 oct-grid__cell--small-6 oct-grid__cell--medium-small-4 oct-grid__cell--medium-4 oct-grid__cell--medium-large-4 oct-listers-hits__item hit oct-listers__item--with-inGrid" data-testid="cell">
        <div class="${id}__plp-banner-header">
            <div class="${id}__plp-img">
                <svg width="305" height="106" viewBox="0 0 305 106" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="305" height="100.754" fill="white" />
                    <path d="M0 76.0797L305 22.6182V105.895H0V76.0797Z" fill="#E41B68" />
                    <path d="M0 0H305V11.3092L0 63.7426L0 0Z" fill="#FAE7F1" />
                    <path
                        d="M172.775 9.38972L117.515 19.2832C109.191 20.7734 103.633 28.8325 105.101 37.2837L111.302 72.989C112.769 81.4402 120.707 87.0833 129.03 85.5931L184.29 75.6996C192.614 74.2094 198.172 66.1503 196.704 57.6991L190.503 21.9938C189.036 13.5426 181.098 7.89953 172.775 9.38972Z"
                        fill="white" />
                    <path
                        d="M175.73 11.4943L120.47 21.3877C112.147 22.8779 106.589 30.937 108.057 39.3882L112.486 64.892C113.953 73.3432 121.891 78.9863 130.214 77.4961L185.474 67.6027C193.798 66.1125 199.356 58.0534 197.888 49.6022L193.459 24.0984C191.991 15.6472 184.054 10.0041 175.73 11.4943Z"
                        stroke="#05054B" stroke-width="4.14356" />
                    <path d="M120.615 37.1396L150.757 31.7432" stroke="#E41B68" stroke-width="4.14356" />
                    <path d="M122.387 47.3408L152.529 41.9444" stroke="#E41B68" stroke-width="4.14356" />
                    <mask id="mask0_103_517" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="144" y="12"
                        width="54" height="59">
                        <path
                            d="M184.599 12.5521L148.55 19.0417C145.772 19.5418 143.914 22.2284 144.4 25.0424L151.439 65.8033C151.925 68.6173 154.571 70.493 157.349 69.9929L193.398 63.5033C196.176 63.0032 198.034 60.3166 197.548 57.5027L190.509 16.7417C190.023 13.9278 187.377 12.052 184.599 12.5521Z"
                            fill="white" />
                    </mask>
                    <g mask="url(#mask0_103_517)">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M251.354 22.994C250.82 20.2903 249.045 17.9229 246.57 17.1116C247.222 15.553 247.839 14.0016 248.414 12.5C249.573 14.1155 251.168 15.799 251.603 18.3131C251.879 19.9068 251.785 21.5378 251.354 22.994ZM249.613 25.9992C248.771 26.8929 247.693 27.525 246.399 27.7575C244.675 28.0676 243.08 27.6111 241.955 26.531C243.316 24.0745 244.611 21.3644 245.805 18.6293C247.87 19.3702 249.069 21.7198 249.46 23.9727C249.581 24.6689 249.633 25.3446 249.613 25.9992ZM240.958 24.863C240.797 24.4706 240.674 24.0432 240.594 23.5828C240.193 21.266 241.472 19.1104 243.588 18.73C243.729 18.7047 243.867 18.6862 244.002 18.6737C242.993 20.8856 241.967 22.9912 240.958 24.863ZM217.373 40.4234C216.629 40.5572 216.185 39.9908 215.985 38.8376C215.341 35.1127 217.161 26.7275 221.457 21.2191C222.19 22.0951 222.656 23.2854 222.884 24.5737C223.975 30.7263 219.998 39.9515 217.373 40.4234ZM197.963 48.0836C197.253 48.2112 196.788 47.6336 196.6 46.5481C195.781 41.811 200.817 24.9299 204.698 24.2321C205.432 24.1002 205.874 24.6821 206.066 25.7923C206.894 30.5787 201.892 47.3773 197.963 48.0836ZM184.011 34.2072C182.871 33.2968 181.671 32.609 180.481 32.119C182.158 25.9095 184.187 19.9643 187.181 15.1672C188.677 16.3004 189.682 18.0328 190.065 20.2483C191.019 25.7651 188.369 31.2325 184.011 34.2072ZM173.781 63.4535C172.739 63.6408 171.77 63.669 170.878 63.5721C174.605 57.3643 176.586 48.1349 178.883 38.8127C180.484 38.5799 181.983 38.1035 183.293 37.6131C184.335 39.1165 185.146 41.0378 185.558 43.4215C186.907 51.2244 182.968 61.8018 173.781 63.4535ZM167.177 62.2576C165.475 61.0211 164.428 59.213 164.169 57.599C164.041 56.7984 164.104 56.0235 164.305 55.3263C164.964 56.3597 166.235 57.0134 167.596 56.7688C168.123 56.6739 168.607 56.4612 169.029 56.1652C168.468 58.4193 167.867 60.4754 167.177 62.2576ZM172.381 34.5166C172.193 33.4286 173.356 33.0259 174.667 32.9634C174.368 33.9861 174.085 35.0128 173.815 36.0402C173.007 35.6779 172.49 35.1444 172.381 34.5166ZM179.93 34.0471C180.503 34.3771 181.061 34.7777 181.591 35.2525C180.898 35.535 180.178 35.7609 179.436 35.9234C179.598 35.2969 179.763 34.6712 179.93 34.0471ZM249.924 7.19291C249.811 6.53712 249.372 6.18824 248.779 6.2949C247.793 6.47205 246.83 7.94511 247.158 9.8381C247.204 10.1053 247.279 10.3649 247.377 10.62C246.564 12.6532 245.707 14.714 244.828 16.7183C244.407 16.707 243.972 16.739 243.525 16.8193C240.664 17.3337 238.101 20.0847 238.796 24.1046C238.986 25.1988 239.335 26.1235 239.796 26.8964C237.849 30.2267 236.019 32.4886 234.565 32.7501C233.988 32.8538 233.589 32.5916 233.473 31.9192C233.348 31.1968 233.486 29.9905 233.883 28.2754L238.953 7.46425L247.837 4.72319L248.483 2.31017L239.751 4.18477L240.669 0.418645L237.337 1.46953L236.343 4.91651L224.129 7.53877L222.705 12.4773L235.281 8.59699L233.615 14.3777C232.19 13.9973 230.526 13.9359 228.666 14.2702C225.855 14.7757 223.364 15.9693 221.226 17.6092C220.065 17.2633 218.821 17.2216 217.596 17.4418C214.626 17.9756 211.522 20.0593 209.242 23.1428C208.384 21.4739 207.04 20.6206 205.327 20.9285C203.33 21.2876 201.398 22.759 199.673 24.8788C198.28 24.0635 196.469 24.0876 194.747 25.1436C195.407 23.0382 195.602 20.888 195.25 18.8524C194.633 15.2885 192.57 12.9636 189.358 11.9143C190.219 10.8847 191.147 9.93623 192.151 9.08287C191.684 8.82214 191.384 8.6589 191.005 8.52169C189.651 9.39958 188.398 10.3734 187.233 11.4292C185.278 11.1505 183.014 11.2357 180.486 11.6902C168.76 13.7982 158.881 22.8129 160.38 31.4859C161.042 35.31 163.365 36.3014 165.427 35.9308C167.357 35.5839 169.048 34.1217 169.409 32.6584C167.671 32.6011 166.417 31.2718 166.086 29.359C164.918 22.606 171.786 15.2783 179.883 13.8227C181.695 13.4968 183.327 13.5639 184.726 13.9777C180.488 18.7903 177.637 24.8074 175.507 31.0814C175.038 31.0904 174.593 31.1335 174.177 31.2083C171.851 31.6264 170.35 32.9643 170.697 34.9688C170.933 36.332 171.988 37.3443 173.444 37.9547C172.236 42.4614 171.271 46.924 170.306 51.0016C169.546 49.9534 168.135 49.4335 166.654 49.6998C163.087 50.341 160.97 54.0752 161.666 58.1013C162.12 60.7269 163.583 63.0554 165.702 64.7484C164.365 66.9863 162.734 68.4661 160.607 68.9015C159.907 69.0448 159.196 68.9964 158.527 68.7427C160.171 68.25 161.32 66.7134 160.993 65.0437C160.666 63.374 159.112 62.4306 157.274 62.8071C155.019 63.2688 154.136 65.4507 154.47 67.1598C155.093 70.3294 157.985 71.5311 161.372 70.8374C164.296 70.2388 166.635 68.6972 168.565 66.4646C170.949 67.4989 173.768 67.8801 176.749 67.3442C185.772 65.722 192.049 56.383 190.199 45.6898C189.465 41.4431 187.827 38.2657 185.801 35.9776C188.547 34.3803 190.821 32.2161 192.469 29.7945C194.773 26.409 196.907 26.2994 198.233 26.8681C194.442 32.7132 192.058 41.4732 192.997 46.9019C193.579 50.2644 195.255 52.223 197.754 51.7738C205.239 50.4282 211.592 33.8543 210.058 25.6521C211.986 22.4558 214.919 20.2319 217.526 19.7631C218.022 19.674 218.482 19.6535 218.908 19.6925C213.799 25.0333 211.421 33.0237 212.396 38.6658C212.913 41.6549 214.723 43.6667 217.486 43.1699C222.638 42.2437 227.911 32.7177 226.476 24.4217C226.036 21.8721 225.006 20.0808 223.664 18.9331C225.273 17.497 227.137 16.4657 229.255 16.0851C230.488 15.8633 231.827 15.9309 233.075 16.2495L229.749 27.7859C228.995 30.5923 228.863 32.5904 229.104 33.9851C229.474 36.1272 230.873 37.0093 232.795 36.6637C235.595 36.1604 238.428 32.8728 241.051 28.4291C242.791 29.9968 245.146 30.4173 246.979 30.0878C247.562 29.9829 248.152 29.8155 248.734 29.5907C247.662 31.6523 245.592 33.4332 242.361 34.918L241.846 40.9536C247.466 38.0055 250.478 32.9059 251.313 28.1606C253.843 26.2664 255.847 23.158 255.207 19.4601C254.501 15.3752 250.775 13.5282 249.061 10.7801C249.769 9.57421 250.092 8.1644 249.924 7.19291Z"
                            fill="#05054B" />
                    </g>
                </svg>
            </div>
            <div class="${id}__plp-banner-header-text">
                price advantage
            </div>
            <div class="${id}__plp-banner-header-promo">
                <div class="${id}__plp-promo-left">
                    <p class="promo-upto-text">Unlock instant savings with Advantage Card</p>
                </div>
            </div>
        </div>
        <ul class="${id}__plp-banner-usps">
            <li>
                <span class='tick-icon'>
                    <svg width="24" height="19" viewBox="0 0 24 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.52783 9.39139L9.90762 16.4099L21.8288 2.36621" stroke="#EA2A7E" stroke-width="3.50927" stroke-linecap="round"/>
                    </svg>
                </span>
                <span class='usp-text'>Lower prices on your favourites with Price Advantage</span>
            </li>
            <li>
                <span class='tick-icon'>
                    <svg width="24" height="19" viewBox="0 0 24 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.52783 9.39139L9.90762 16.4099L21.8288 2.36621" stroke="#EA2A7E" stroke-width="3.50927" stroke-linecap="round"/>
                    </svg>
                </span>
                <span class='usp-text'>10% off our amazing Boots brands</span>
            </li>
            <li>
                <span class='tick-icon'>
                    <svg width="24" height="19" viewBox="0 0 24 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.52783 9.39139L9.90762 16.4099L21.8288 2.36621" stroke="#EA2A7E" stroke-width="3.50927" stroke-linecap="round"/>
                    </svg>
                </span>
                <span class='usp-text'>Earn 3 points for every Â£1 you spend</span>
            </li>
        </ul>
        <div class="${id}__link-button-wrapper">
            <a href='https://www.boots.com/AdvantageCardApply' class="${id}__link-button">
                <span class='desktop-unlock-btn'>UNLOCK NOW</span>
                <span class='mobile-unlock-btn'>UNLOCK</span>
            </a>
        </div>
    </div>`;

    pollerLite(['#hits', () => document.querySelectorAll('[aria-label*="with Advantage Card"]').length > 0 ||
        window.location.href.includes('Save+10+percent+on+selected+Boots+Brand+with+your+Advantage+Card') ||
        (document.querySelector('.oct-teaser__offer__container') &&
            document.querySelector('.oct-teaser__offer__container').innerText.includes('Advantage Card'))], () => {
                const reporting = new TestReporting(testID, testVariant); // sends experience id event to datalayer
                reporting.register(); // sends experience load event to datalayer

                if (VARIATION == 'control') {
                    return;
                }
                
                //remove all existing banners
                const plpBanners = document.querySelectorAll(`.${id}__plp-banner`);

                if (plpBanners.length > 0) {
                    plpBanners.forEach((banner) => {
                        banner?.remove();
                    });
                }

                document.body.classList.add(`${id}__plpPage`);

                const firstProductCard = document.querySelector('#hits [data-testid="cell"]');
                firstProductCard.insertAdjacentHTML('beforebegin', plpBanner);
            });
};

export default plpPage;
