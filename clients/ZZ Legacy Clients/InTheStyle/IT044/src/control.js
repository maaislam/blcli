import * as UC from '../../../../lib/uc-lib';
import * as utils from '../../../../lib/utils';

// --------------------------------------------
// Created this in order to fire events on control
// --------------------------------------------

$(document).ready(function() {

    var UC=function(t){var e=e||window.jQuery;return t.poller=function(t,e,n){var a={wait:50,multiplier:1.1,timeout:0},r=Date.now||function(){return(new Date).getTime()};if(n)for(var o in n)a[o]=n[o];else n=a;for(var i=!!a.timeout&&new Date(r()+a.timeout),s=a.wait,l=a.multiplier,f=[],c=function(n,a){if(i&&r()>i)return!1;a=a||s,function(){var t=typeof n;return"function"===t?n():"string"!==t||document.querySelector(n)}()?(f.push(!0),f.length===t.length&&e()):setTimeout(function(){c(n,a*l)},a)},d=0;d<t.length;d++)c(t[d])},t.throttle=function(t,e){var n,a,r,o=null,i=0;return function(){var s=Date.now||function(){return(new Date).getTime()};s=s(),i||(i=s);var l=e-(s-i);return n=this,a=arguments,(l<=0||l>e)&&(o&&(clearTimeout(o),o=null),i=s,r=t.apply(n,a),o||(n=a=null)),r}},t.group=function(t,e){for(var n=[],a=0;a<t.length;a+=e)n.push(t.slice(a,a+e));return n},t.hoverDelay=function(t,n,a){if(!e)return!1;var r,o,i=Date.now||function(){return(new Date).getTime()};return a||(a=1e3),e(t).hover(function(){o=i()},function(){r||i()-o>=a&&(n(),r=!0)}),t},t.observer={active:[],connect:function(t,e,n){var a={throttle:1e3,config:{attributes:!0,childList:!0,subTree:!1}};if(n)for(var r in n)a[r]=n[r];else n=a;for(var o,i=new MutationObserver(function(n){n.forEach(function(n){o||(o=!0,e(t,n),setTimeout(function(){o=!1},a.throttle))})}),s=0;s<t.length;s++)i.observe(t[s],a.config),this.active.push([t[s],i])},disconnect:function(t){for(var e=this.active,n=0;n<t.length;n++)for(var a=t[n],r=0;r<e.length;r++)a===e[r][0]&&e[r][1].disconnect()}},t.feedbackTab=function(){if(!e)return!1;var t,n,a,r,o,i,s,l=function(e){var n=t||{label:!1,content:!1,position:"left",customClass:!1,sessionClose:!0,tabDimensions:{height:"auto",width:"350px"},contentDimensions:{height:"350px",width:"600px"},mobileBreakpoint:768,animationSpeed:600,dimBackground:!1,zIndex:99999};if(e)for(var a in e)n[a]=e[a];else e=n;return n},f=function(){var n=e(['<div class="UC_fb-tab-container">','<div class="UC_fb-tab">','<span class="UC_fb-tab__inner"></span>','<span class="UC_fb-tab__close">&#215;</span>',"</div>",'<div class="UC_fb-content">','<div class="UC_fb-content__inner"></div>',"</div>","</div>"].join("")),r=n.find(".UC_fb-tab"),o=n.find(".UC_fb-content");return t.label&&r.find(".UC_fb-tab__inner").html(t.label),t.content&&o.find(".UC_fb-content__inner").html(t.content),t.customClass&&n.addClass(t.customClass),t.dimBackground&&(a=e('<div class="UC_fb-tab-bg"></div>')),r.css({height:t.tabDimensions.height,width:t.tabDimensions.width}),o.css({height:t.contentDimensions.height,width:t.contentDimensions.width}),n},c=function(){n&&n.remove(),a&&a.remove()},d=function(){var e,n;switch(t.position){case"left":e="-webkit-transform:rotate(-90deg) translateX(-50%);-moz-transform:rotate(-90deg) translateX(-50%);-ms-transform:rotate(-90deg) translateX(-50%);-o-transform:rotate(-90deg) translateX(-50%);transform:rotate(-90deg) translateX(-50%);transform-origin:top left;top:50%;left:100%;",n="top:50%;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%);transform:translateY(-50%);left:-100%;",s="width";break;case"right":e="-webkit-transform:rotate(-90deg) translateY(-100%);-moz-transform:rotate(-90deg) translateY(-100%);-ms-transform:rotate(-90deg) translateY(-100%);-o-transform:rotate(-90deg) translateY(-100%);transform:rotate(-90deg) translateY(-100%);transform-origin:top right;right:100%;",n="top:50%;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%);transform:translateY(-50%);right:-100%;",s="width";break;case"bottom":e="-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%);transform:translateX(-50%);bottom:100%;left:50%;",n="left:50%;-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%);transform:translateX(-50%);bottom:-100%;",s="height";break;case"top":e="-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%);transform:translateX(-50%);top:100%;left:50%;",n="left:50%;-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%);transform:translateX(-50%);top:-100%;",s="height";break;default:e="",n="",s="width"}var a=document.createElement("style");a.type="text/css";var r=".UC_fb-tab,.UC_fb-tab__close{display:inline-block;cursor:pointer}.UC_fb-content,.UC_fb-tab{max-width:100%;max-height:100%;box-sizing:border-box;background:#fff}.UC_fb-tab-container{position:fixed;z-index:"+t.zIndex+";"+n+"}.UC_fb-tab{position:absolute;margin:0 auto;text-align:center;z-index:"+t.zIndex+";color:#333;font-size:15px;padding:10px 10px 10px 20px;"+e+"}.UC_fb-tab__inner{display:inline-block;margin:0 auto}.UC_fb-tab__close{position:absolute;right:10px;font-family:sans-serif}.UC_fb-content{padding:20px;text-align:left;position:relative;}.UC_fb-tab-bg{display:none;background:#000;opacity:0.7;position:fixed;top:0;right:0;bottom:0;left:0;z-index:"+(t.zIndex-1)+";}";return a.styleSheet?a.styleSheet.cssText=r:a.appendChild(document.createTextNode(r)),a},u=function(){r&&r.parentElement.removeChild(r)},m=function(){var t=e(".UC_fb-tab-container"),n=t.children(".UC_fb-tab"),a=t.children(".UC_fb-content"),r=e(window);return{window:{width:r.innerWidth(),height:r.innerHeight()},tab:{width:n.outerWidth(),height:n.outerHeight()},content:{width:a.outerWidth(),height:a.outerHeight()}}},h=function(e){e||(e=m()),t||(t=l());var n={remove:{},open:{},close:{}};return n.remove[t.position]="-100%",n.open[t.position]="0",n.close[t.position]="-"+e.content[s]+"px",n},b=function(e){if(!e)return!1;var n=e.find(".UC_fb-tab"),r=e.find(".UC_fb-content"),s="closed";n.click(function(){var n,l,f;i=m(),o=h(i),n=i.window.width-i.tab.height-5,l=i.window.height-i.tab.height-5,r.css({"max-width":n,"max-height":l}),i.content.width>n&&(i.content.width=n),i.content.height>l&&(i.content.height=l),"open"===s?(f=o.close,a&&a.fadeOut()):(f=o.open,a&&a.fadeIn()),e.animate(f,t.animationSpeed,function(){s="open"===s?"closed":"open"})}),n.find(".UC_fb-tab__close").click(function(n){n.stopPropagation(),a&&a.fadeOut(),e.animate(o.remove,t.animationSpeed),t.sessionClose&&window.sessionStorage.setItem("ucfbtab-closed",1)})};return{init:function(e){var c=l(e);t!==c&&(t=c),t.sessionClose&&window.sessionStorage.getItem("ucfbtab-closed")||(n=f(),r=d(),n.prependTo("body"),document.body.insertBefore(r,n[0]),t.dimBackground&&n.before(a),i=m(),o=h(i),b(n),n.css(t.position,"-"+i.content[s]+"px"))},destroy:{component:c,css:u,all:function(){c(),u()}},refresh:function(t){this.destroy.all(),this.init(t)}}}(),t.countdown=function(t){function e(t){var e=function(){return i[t.getDay()]},n=function(){return f.indexOf(e())>-1};if(n())for(;n();)t.setDate(t.getDate()+1);return t}var n={cutoff:null,element:null,labels:{d:"days",h:"hours",m:"minutes",s:"seconds"},delivery:{deliveryDays:null,excludeDays:null,deliveryDayElement:null,tomorrowLabel:!1}},a=function(t,e){var n,r;for(var o in e)n=t[o],r=e[o],Object.keys&&-1===Object.keys(t).indexOf(o)||("object"==typeof r?"[object Array]"===Object.prototype.toString.call(r)?t[o]=r:a(n,r):t[o]=r)};a(n,t);var r=new Date,o=new Date(n.cutoff),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=n.delivery,l=s.deliveryDays,f=s.excludeDays,c=s.deliveryDayElement,d={};r>o&&(o.setDate(o.getDate()+1),o=e(o)),d.cutoff=o.getTime();var u=Math.floor((o.getTime()-r.getTime())/1e3),m=document.querySelectorAll(n.element),h=setInterval(function(){var t=Math.floor(u/24/60/60),e=Math.floor(u-86400*t),a=Math.floor(e/3600),r=Math.floor(e-3600*a),o=Math.floor(r/60),i=u%60;i<10&&(i="0"+i);for(var s=0,l=m.length;s<l;s++)m[s].innerHTML=[t>0?'<span class="UC_cd-days">'+t+"</span> "+n.labels.d+" ":"",'<span class="UC_cd-hours">'+a+"</span> "+n.labels.h+" ",'<span class="UC_cd-minutes">'+o+"</span> "+n.labels.m+" ",'<span class="UC_cd-seconds">'+i+"</span> "+n.labels.s+" "].join("");0===u?clearInterval(h):u--},1e3);if(l){var b=function(){var t=new Date;return t.setDate(o.getDate()+l),t=e(t)}(),g=document.querySelectorAll(c),p=i[b.getDay()];if(s.tomorrowLabel){var v=new Date(r);v.setDate(v.getDate()+1),v.getFullYear()==b.getFullYear()&&v.getMonth()==b.getMonth()&&v.getDate()==b.getDate()&&(p="tomorrow")}for(var w=0,y=g.length;w<y;w++)g[w].innerHTML=p;d.deliveryDate=b.getTime(),d.deliveryDay=p}return d},t}(UC||{});

    var blockNav = $('.block-layered-nav'),
        blockTitle = blockNav.find('.block-title:first');

    blockTitle.on('click', function() {
        ga('send', 'event', 'IT044-Filters-CONTROL', 'did-click-filter-by-to-open-filters'); 
    });

    $('.block-layered-nav').on('click', 'dd li a', () => {
        ga('send', 'event', 'IT044-Filters-CONTROL', 'clicked-direct-filter'); 
    });

    $('.col-left.sidebar').on('click', '.IT011_applyFiltersButton', () => {
        ga('send', 'event', 'IT044-Filters-CONTROL', 'did-click-apply-filters-button'); 
    });

    UC.observer.connect([].slice.call($('.block-layered-nav .checkbox-filter')), () => {
        ga('send', 'event', 'IT044-Filters-CONTROL', 'did-click-checkbox-filter'); 
    }, {
        config: {attributes: true, childList: false, subtree: false},
        throttle: 100
    });
});
