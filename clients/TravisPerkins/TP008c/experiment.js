// ------------------------------------------------------------------
// TP008c
// 
// P&P products in basket - messaging
//
// - Desktop: assumes TP027 is running and set to 100%
// ------------------------------------------------------------------
var _TP008c = (function() {
    // UC Library - Poller -- @version 0.2.2
    var UC=function(a){return a.poller=function(a,b,c){var d={wait:50,multiplier:0,timeout:7000},e=Date.now||function(){return(new Date).getTime()};if(c)for(var f in c)d[f]=c[f];else c=d;for(var g=!!d.timeout&&new Date(e()+d.timeout),h=d.wait,i=d.multiplier,j=[],l=function(c,d){if(g&&e()>g)return!1;d=d||h,function(){var a=typeof c;return"function"===a?c():"string"!==a||document.querySelector(c)}()?(j.push(!0),j.length===a.length&&b()):setTimeout(function(){l(c,d*i)},d)},m=0;m<a.length;m++)l(a[m])},a}(UC||{});

    var targetProducts = [
            '129561', '966818', '770252', '766740', '205651', '205654', '391963', '391967', '535139', '521829', '521830', '133694', '133695', '136245', '187097', '963380', '575244', '780887', '780943', '784091', '784868', '787761', '790424', '790427', '790429', '790435', '790445', '791481', '793585', '795072', '795200', '795601', '796006', '796016', '796072', '796078', '796079', '796081', '796114', '796119', '796135', '796252', '796406', '796714', '797672', '798172', '799275', '800243', '800272', '800805', '801363', '801364', '801852', '802088', '802492', '802493', '802500', '802505', '802510', '802525', '802530', '802541', '802546', '802833', '802922', '802956', '802958', '804375', '805774', '805782', '807849', '808046', '808061', '808784', '809479', '810295', '810303', '811269', '813254', '813255', '813762', '813896', '813898', '814089', '814907', '814908', '815092', '816062', '816067', '817100', '818209', '820143', '820174', '820179', '820180', '820201', '820203', '820218', '820220', '820232', '820625', '820942', '820968', '820980', '820982', '821027', '821142', '821143', '821154', '821157', '821160', '821167', '821169', '821173', '821263', '821264', '821329', '808172', '821609', '821656', '822018', '823192', '823195', '823210', '823219', '823794', '824620', '824629', '826261', '826278', '826315', '826321', '828691', '833111', '833133', '833324', '833753', '833756', '835057', '835483', '836174', '840705', '841182', '841266', '841267', '841269', '843611', '844332', '844563', '845040', '845157', '849354', '850234', '850422', '850477', '850487', '850506', '850507', '850702', '850707', '850765', '853206', '853597', '854257', '854812', '855242', '855243', '855245', '855263', '856590', '856957', '859094', '859112', '860453', '863329', '863337', '864369', '864379', '864562', '865034', '866219', '866226', '866228', '866229', '866230', '867403', '868323', '869137', '874748', '874749', '876024', '876025', '877070', '879247', '879253', '879411', '879414', '879415', '879417', '879419', '879453', '880951', '880955', '880956', '881610', '881802', '884059', '884060', '884061', '884448', '885401', '885403', '885410', '886396', '886445', '887383', '888254', '888524', '894299', '901022', '903688', '903689', '903695', '903708', '905463', '906057', '906058', '906393', '906779', '908395', '908504', '909156', '909778', '909849', '909870', '909978', '910254', '910304', '910737', '910832', '910833', '912394', '914826', '914831', '915379', '916241', '916275', '916411', '916425', '916453', '916470', '916501', '917287', '917326', '918989', '921089', '921882', '923248', '923251', '923253', '923267', '923281', '925015', '926427', '927844', '928155', '929276', '929798', '929990', '930826', '930989', '931124', '931254', '931556', '931735', '933303', '935114', '938057', '940387', '941082', '943271', '945079', '945198', '947562', '948552', '949685', '950203', '954174', '956058', '956067', '956069', '956071', '956078', '956082', '957219', '960027', '960845', '960858', '960995', '961104', '961105', '961545', '961546', '961547', '961626', '961630', '966817', '971954', '972107', '972222', '972223', '972930', '972948', '972949', '972974', '972994', '978587', '979152', '979813', '979814', '979816', '981890', '982596', '984089', '984784', '985427', '988019', '991208', '994073', '998766', '107774', '107775', '107776', '107777', '107778', '107779', '107799', '107800', '107801', '107802', '107803', '107804', '107805', '107806', '107807', '107809', '107810', '107812', '107813', '107814', '107816', '108512', '108515', '115640', '126243', '130320', '130731', '130733', '654249', '134243', '828295', '136234', '136244', '136246', '136248', '136252', '136253', '136257', '136258', '136261', '136300', '139997', '140006', '140008', '141502', '143933', '146961', '146971', '146987', '146995', '146997', '148121', '148230', '150153', '153584', '154071', '154094', '154308', '154493', '154543', '154548', '154561', '154566', '154568', '154616', '154791', '154987', '752657', '507979', '956199', '168919', '169324', '171435', '175591', '177776', '177959', '558564', '182144', '185688', '185698', '185704', '663164', '185711', '185713', '187345', '187930', '189471', '200752', '201617', '201751', '205650', '841268', '319425', '215023', '215029', '215427', '217016', '218042', '219314', '221468', '224562', '226318', '229255', '235610', '235613', '247245', '249615', '251800', '251803', '252284', '252285', '252299', '252301', '252302', '252303', '257501', '257795', '260606', '260698', '260699', '260703', '260705', '260707', '260709', '262004', '262010', '262016', '764668', '262027', '820844', '262038', '262039', '262059', '262063', '262064', '262065', '262068', '262070', '262072', '262075', '262076', '262091', '262102', '262104', '262110', '262127', '262130', '262131', '262141', '262142', '262165', '271039', '271045', '272161', '272171', '274442', '274474', '276447', '276906', '279229', '889527', '283377', '285060', '287922', '353970', '297633', '297649', '297653', '975410', '301671', '301843', '301844', '301849', '301853', '301855', '301858', '301860', '301871', '307296', '307452', '308108', '826306', '314581', '526655', '115086', '716290', '323360', '325954', '325966', '325969', '325981', '327777', '328199', '328201', '328876', '328881', '328884', '328887', '328888', '328890', '328891', '328900', '330394', '330420', '331602', '334067', '334073', '334074', '336564', '336567', '336569', '336570', '136227', '340292', '689806', '752659', '344303', '344304', '347475', '347736', '347743', '349001', '349006', '349696', '349724', '349730', '350007', '351477', '351868', '352430', '352432', '352434', '352435', '352439', '352444', '352445', '352448', '352450', '352452', '221564', '352471', '352476', '352477', '352478', '352485', '352486', '352487', '353633', '352454', '355021', '685888', '356028', '720895', '759020', '360787', '361615', '363459', '363468', '920824', '364549', '367711', '370232', '370258', '370311', '370313', '147008', '372723', '372726', '372727', '381222', '383742', '384430', '384431', '384432', '187351', '384856', '384892', '384898', '384899', '384900', '390797', '390799', '352455', '394929', '394930', '394931', '394932', '422363', '394940', '394942', '394943', '517704', '612988', '409535', '413863', '415832', '422170', '422214', '422234', '422250', '422252', '422255', '422298', '803609', '422343', '422344', '820833', '422368', '422406', '422698', '422701', '900560', '431531', '961958', '987608', '440376', '440377', '443383', '456096', '456168', '456210', '456231', '457760', '460386', '466513', '467375', '467826', '467836', '470936', '470959', '353974', '604572', '694587', '712938', '811790', '820073', '821616', '850283', '480861', '484377', '993609', '136224', '150234', '495937', '495944', '498293', '498298', '503386', '504647', '504985', '276868', '506340', '506401', '507074', '510137', '510138', '512425', '512491', '516933', '517056', '382120', '517703', '517706', '517731', '519082', '519491', '519497', '519649', '519714', '520981', '521852', '522277', '523493', '523766', '523768', '523769', '523771', '524236', '524444', '524501', '524911', '526194', '527140', '527677', '527697', '586056', '528216', '528960', '529724', '650286', '696388', '533697', '534324', '534782', '535136', '535138', '535856', '536877', '766921', '538373', '790176', '541798', '542203', '542501', '813761', '817862', '550328', '850421', '551611', '552234', '554736', '556148', '885108', '561341', '564289', '564310', '564320', '564321', '564332', '564352', '564380', '565451', '566713', '567140', '569803', '570254', '570804', '572860', '576749', '931310', '932997', '578959', '578980', '578984', '579007', '580574', '583765', '935434', '935755', '584860', '966820', '984090', '589856', '599243', '602736', '602773', '604575', '604577', '604580', '604583', '604584', '604589', '604610', '604813', '130315', '606792', '610997', '611199', '615463', '615487', '615624', '624528', '625595', '635063', '636294', '187929', '205653', '640494', '640500', '640503', '643424', '643431', '650150', '650158', '650160', '650169', '650173', '650175', '650179', '650212', '650255', '650265', '650267', '650270', '650278', '271701', '650296', '650301', '650302', '652155', '652204', '652928', '653000', '653001', '653003', '653004', '653014', '653015', '653016', '653017', '323210', '659495', '659500', '660581', '663525', '663601', '663806', '349993', '666378', '352449', '671543', '671552', '671553', '671557', '384438', '394934', '672502', '681755', '403343', '683003', '422314', '469318', '517109', '690523', '690524', '537977', '693360', '554086', '693805', '696390', '663387', '697109', '697110', '697111', '698371', '698392', '698512', '699386', '710288', '711459', '685890', '713246', '713238', '726939', '718334', '718417', '719314', '740020', '740024', '747769', '721156', '722271', '722679', '723681', '723682', '723892', '723893', '766742', '770258', '726500', '796446', '729200', '729201', '798670', '729205', '729760', '802953', '804016', '732441', '805781', '736700', '737196', '737198', '737740', '740022', '807922', '740036', '740417', '740878', '743274', '833643', '850428', '850733', '747755', '747771', '749946', '750465', '750561', '750953', '751423', '751432', '751612', '879410', '885131', '893334', '898549', '906394', '906509', '754084', '908468', '755436', '758370', '758387', '758398', '758401', '758442', '758684', '759909', '762132', '762824', '939128', '967886', '766927', '766928', '769525', '769607', '769608', '769613', '125789', '130347', '772489', '773024', '773029', '773049', '773050', '773051', '773675', '773677', '133488', '776258', '778938', '780102', '781654', '781655', '781705', '781707', '136223', '786128', '786230', '140707', '142042', '142043', '790420', '790423', '790437', '790471', '790473', '145301', '791660', '791661', '171785', '177972', '181813', '796007', '796008', '185696', '796020', '796070', '796074', '796089', '796091', '796093', '796095', '796097', '796101', '796102', '796103', '796108', '188168', '796131', '201581', '796138', '796140', '796142', '796146', '796147', '796405', '203192', '212036', '217646', '800642', '800806', '800807', '800915', '801249', '802006', '235598', '802494', '802495', '262020', '802520', '262071', '802528', '262124', '802531', '802545', '271687', '271689', '802935', '803585', '803586', '281347', '803611', '282084', '289115', '301751', '305039', '305040', '306048', '310806', '811270', '811273', '811278', '811279', '811295', '811298', '323197', '323198', '323213', '813747', '328521', '352431', '352453', '352462', '817035', '817100', '101879', '104543', '105155', '108197', '108510', '108914', '109856', '109857', '109858', '109859', '116563', '117359', '117387', '118752', '119622', '119656', '121670', '121672', '127733', '128981', '130319', '131142', '133330', '133331', '133503', '134237', '136653', '140002', '140011', '141720', '142439', '142442', '146393', '146960', '146979', '146999', '147449', '147831', '147899', '149680', '150151', '151070', '151848', '153579', '153581', '153585', '153588', '153593', '153594', '153598', '153606', '153621', '154165', '154256', '154355', '154360', '154384', '154393', '154423', '154465', '154544', '154590', '154593', '154632', '154660', '154834', '159972', '159973', '159994', '159995', '160421', '164704', '165443', '168922', '171434', '174029', '175912', '177913', '177992', '178017', '180527', '181674', '181999', '183635', '184968', '184970', '189417', '189420', '189430', '201576', '201580', '201621', '201625', '201636', '201639', '201772', '201994', '202884', '207731', '207739', '209322', '211332', '214382', '214383', '214384', '214385', '214386', '214387', '215663', '218734', '219786', '219790', '219793', '219796', '219797', '220835', '220836', '220837', '220838', '220941', '222455', '222459', '224240', '224567', '226317', '226326', '229254', '229256', '229760', '229765', '229766', '230396', '231907', '231908', '238452', '238456', '243819', '243937', '245811', '245812', '245813', '245814', '245816', '245817', '250949', '250950', '250951', '254271', '254272', '254273', '254275', '254276', '256913', '257103', '257134', '257414', '260607', '260608', '260613', '260614', '261188', '262000', '262002', '262011', '262019', '262035', '262057', '262060', '262061', '262074', '262078', '262079', '262090', '262095', '262097', '262098', '262099', '262101', '262108', '262112', '262114', '262117', '262118', '262119', '262120', '262123', '262125', '262129', '262133', '262136', '262139', '262145', '262146', '262147', '262149', '262150', '262161', '262162', '262164', '262166', '263550', '264180', '264184', '264187', '264189', '264190', '264193', '264200', '264210', '271041', '271043', '271047', '271669', '272445', '272721', '274331', '274453', '274967', '274991', '275016', '276448', '276858', '276865', '277684', '284068', '284070', '284477', '284478', '285064', '285066', '285068', '287628', '287813', '289425', '289755', '289778', '289781', '289790', '291098', '291767', '291769', '294855', '294869', '299497', '299504', '301304', '301306', '301948', '301954', '303090', '303099', '303110', '304871', '305046', '305120', '306887', '308391', '310799', '310802', '310803', '310804', '312871', '313144', '313599', '314449', '314461', '314837', '315739', '316637', '317795', '319005', '319745', '323193', '323202', '323204', '323206', '323208', '323209', '323216', '323217', '323877', '323878', '324924', '325955', '325956', '325957', '325958', '325961', '325962', '325964', '325965', '325971', '327521', '327781', '328200', '328206', '328306', '328522', '328532', '330582', '331284', '331458', '334070', '334079', '334081', '335651', '336571', '336573', '339441', '339442', '339453', '339454', '340151', '340152', '341616', '341648', '344441', '345131', '347477', '729207', '185715', '431862', '353300', '923275', '535121', '352458', '352430', '729200', '146990', '431753', '852801', '352483', '146979', '146999', '146960', '923263', '535137', '185677', '185705', '185678', '923259', '146985', '492001', '769314', '778938', '820150', '820158', '820172', '820176', '820177', '820197', '820198', '820200', '384440', '820214', '820217', '820242', '820619', '820747', '820834', '820835', '820838', '820843', '401433', '405311', '820989', '821158', '821161', '431534', '439692', '821364', '456093', '821622', '463122', '466286', '822032', '826071', '827594', '498292', '834744', '834985', '835046', '835054', '835112', '500628', '836104', '505616', '838371', '507976', '511200', '842138', '843450', '843604', '843610', '844220', '844223', '844287', '844296', '844299', '844307', '844310', '844311', '844507', '844635', '517701', '845154', '845488', '845728', '849068', '517729', '849423', '520684', '850053', '850106', '521491', '524479', '850282', '525825', '850299', '850369', '527514', '527700', '529764', '850505', '850513', '850585', '850592', '850730', '851125', '851545', '854058', '537981', '541123', '855717', '855912', '861484', '861485', '861486', '863336', '863338', '864686', '578924', '599242', '604609', '868633', '869136', '870812', '870814', '870815', '871630', '873179', '873184', '874750', '875889', '878148', '640493', '878497', '879130', '650260', '879254', '650261', '650303', '879416', '665025', '881171', '884059', '884060', '884061', '884687', '884706', '885090', '885400', '693804', '694185', '886399', '886461', '697106', '713233', '713249', '716185', '888657', '719344', '719373', '893024', '893297', '723675', '723678', '893975', '725408', '894351', '727607', '900565', '901019', '729134', '902638', '903686', '903690', '903691', '905462', '905566', '905583', '906062', '730331', '906888', '746805', '908357', '750674', '753672', '753688', '753690', '765955', '769611', '769866', '769868', '910913', '910919', '911895', '778327', '912972', '792923', '916273', '916275', '916283', '802079', '920483', '920484', '920625', '803983', '923032', '923237', '923240', '923245', '804996', '923252', '923261', '923270', '923271', '923272', '923276', '923279', '923282', '926933', '927464', '929983', '929990', '930422', '930813', '930814', '930815', '930820', '930826', '930829', '930837', '930840', '930843', '930887', '930891', '930904', '930911', '931064', '931065', '931215', '931264', '931271', '815095', '817427', '932625', '820184', '820832', '933340', '934589', '821028', '934967', '821047', '936539', '821465', '821670', '821865', '823140', '840450', '844637', '849162', '850044', '940981', '945494', '850281', '947723', '850441', '948554', '948600', '949502', '949505', '850701', '850766', '950208', '950493', '950494', '950508', '856958', '878302', '878321', '878498', '952506', '952526', '884558', '954587', '954588', '955054', '955090', '956044', '956061', '956064', '956079', '956081', '901020', '956202', '956891', '957234', '958767', '958791', '960809', '960817', '960822', '960826', '960827', '960829', '960834', '960855', '960856', '910911', '910918', '919475', '961533', '961537', '961542', '961612', '961627', '923285', '963290', '964064', '930257', '967119', '967785', '967933', '970262', '971957', '972085', '972553', '972933', '972935', '972994', '973001', '973009', '975404', '978628', '978629', '979064', '979170', '979815', '979820', '979837', '979841', '948830', '950186', '950190', '950196', '981775', '981776', '981777', '981970', '982252', '983048', '984091', '952751', '953251', '985638', '985640', '986353', '986354', '954172', '954305', '956896', '957228', '988015', '988380', '971168', '991187', '995395', '995925', '997111', '998224', '995365', '999407', '347593', '347771', '348859', '349995', '351904', '353092', '353663', '354962', '357347', '357899', '358216', '358217', '358218', '360703', '360707', '361052', '361053', '361054', '361893', '363476', '367713', '367718', '367864', '367880', '367892', '368027', '368028', '368082', '372728', '372734', '373880', '378624', '378625', '378626', '383489', '383513', '383865', '383866', '384731', '384878', '384881', '384887', '384889', '384891', '384893', '384894', '384896', '384897', '384941', '386318', '386319', '390548', '390551', '390794', '390795', '390796', '390800', '390872', '390873', '390874', '390875', '390877', '390938', '390940', '390941', '394921', '394923', '394926', '394935', '394936', '394938', '394939', '396389', '400144', '400145', '400146', '400147', '401486', '401487', '410365', '411223', '411225', '413853', '413865', '413866', '414324', '414325', '415678', '415682', '416413', '416574', '416583', '417136', '417145', '417162', '417293', '425640', '427302', '431861', '432521', '433787', '433788', '439468', '440348', '440349', '440350', '440353', '440354', '440356', '440357', '440361', '440363', '440365', '440366', '440367', '440368', '440370', '440371', '440372', '440374', '440375', '440378', '440406', '440407', '440408', '440409', '440412', '440413', '440414', '440415', '440417', '440419', '440420', '440423', '440425', '440427', '440429', '440430', '440431', '440432', '440433', '441900', '442147', '442151', '443316', '443320', '449178', '449180', '450453', '450459', '450461', '455412', '456068', '456092', '456133', '456535', '457430', '457449', '457465', '457467', '457755', '459609', '465857', '465858', '465864', '465865', '466934', '466936', '466938', '470934', '470937', '470975', '473841', '475091', '475092', '475483', '479615', '479616', '488924', '488937', '491131', '491861', '492840', '495756', '495760', '495762', '496271', '496717', '496876', '497146', '500442', '500444', '500605', '500608', '501253', '501255', '501256', '501257', '501607', '501688', '501706', '501826', '502149', '502372', '502677', '502724', '502751', '502752', '502774', '502996', '503060', '503218', '503473', '503707', '503721', '503887', '503892', '504245', '504366', '504577', '504594', '504598', '504645', '504881', '504891', '504893', '505053', '506137', '506150', '506336', '507089', '507722', '507995', '509242', '510140', '510141', '510165', '510167', '510172', '510175', '510195', '510202', '510204', '510206', '510210', '510212', '511382', '511816', '511895', '512167', '512536', '513957', '517115', '517700', '519549', '519708', '519712', '519713', '519716', '519717', '519822', '519825', '519991', '520214', '520969', '521729', '521925', '521994', '522381', '522383', '523401', '523593', '523596', '523673', '524354', '524586', '524588', '524877', '524878', '524904', '525462', '525463', '525464', '526440', '526466', '527699', '528068', '528981', '529538', '529539', '529540', '529726', '529807', '529814', '529816', '529837', '529841', '531854', '532166', '532167', '532484', '532486', '532876', '534120', '534555', '534557', '534998', '535738', '536348', '536932', '536933', '536935', '536936', '536939', '536940', '536941', '536942', '536943', '536944', '538289', '540648', '540659', '540669', '541125', '541601', '541789', '542205', '542206', '542216', '542218', '542219', '542276', '542277', '542278', '542371', '542564', '542566', '542572', '543300', '543301', '549621', '551235', '551715', '551716', '551956', '551957', '551958', '551967', '552213', '552270', '552574', '552603', '552646', '553015', '553046', '553066', '553416', '553417', '556681', '557544', '559007', '560260', '561786', '564309', '564311', '567621', '568667', '569837', '569850', '570353', '570571', '572090', '572677', '572685', '572688', '572690', '572695', '572699', '572992', '573021', '573268', '574306', '574617', '574775', '574824', '575034', '575056', '576033', '576352', '576386', '576488', '576538', '576632', '576710', '576737', '577344', '577355', '577589', '577593', '578801', '578969', '578972', '578974', '578983', '579009', '579010', '580061', '580063', '580559', '580571', '581806', '581845', '583758', '584945', '590264', '591886', '598227', '598263', '599470', '600806', '600826', '604172', '604574', '604586', '604587', '604605', '604607', '604608', '605103', '610675', '612896', '612911', '612914', '612920', '612925', '612931', '615563', '615595', '616791', '616915', '618889', '619628', '620942', '623420', '624529', '626594', '627060', '630420', '632455', '632488', '632782', '633264', '633354', '634171', '634174', '634188', '634190', '635761', '639886', '640495', '640646', '642408', '642409', '642410', '644788', '645237', '645239', '645267', '645272', '646560', '646561', '646562', '650137', '650138', '650142', '650146', '650148', '650152', '650155', '650157', '650163', '650164', '650166', '650168', '650171', '650172', '650213', '650214', '650215', '650216', '650229', '650231', '650234', '650235', '650236', '650250', '650251', '650252', '650253', '650259', '650263', '650266', '650268', '650276', '650277', '650280', '650281', '650282', '650283', '650284', '650299', '650602', '650603', '650604', '651054', '651687', '653002', '653005', '653010', '653020', '653674', '653726', '653746', '659272', '659487', '659488', '659489', '659490', '659491', '659497', '659498', '663809', '665003', '666760', '666792', '666816', '666817', '666818', '670812', '671525', '671542', '671544', '671558', '671749', '671767', '671771', '672496', '673274', '676403', '677140', '679817', '679937', '679939', '679942', '681247', '682894', '684513', '685253', '686019', '686122', '686614', '686632', '687913', '688448', '690231', '690232', '691032', '691036', '691040', '691136', '691139', '691142', '691144', '691147', '691151', '691184', '691190', '691216', '691253', '691254', '691263', '691594', '691965', '691973', '692390', '692798', '692800', '692802', '692803', '692806', '692856', '693082', '693709', '695025', '697107', '697108', '698616', '699046', '699172', '699393', '699638', '703881', '704238', '704243', '708634', '708971', '708976', '708984', '708985', '708986', '709124', '709126', '709127', '709128', '709130', '709145', '709153', '709158', '709248', '709257', '709259', '711423', '712458', '714003', '714004', '714006', '714007', '714031', '714032', '714033', '717387', '717763', '717765', '717766', '717904', '719311', '723723', '723868', '723869', '723870', '723871', '723876', '723879', '723880', '724738', '724739', '724740', '724767', '724768', '724769', '724782', '724783', '724784', '724913', '725066', '725067', '725071', '725072', '725078', '725083', '725085', '725086', '726034', '726256', '726285', '726311', '726313', '726435', '726474', '726477', '726511', '726512', '726513', '726514', '726524', '726698', '727808', '727817', '727821', '728734', '729139', '729356', '729488', '729512', '729516', '729517', '729521', '729522', '729591', '729656', '730341', '730655', '730656', '730657', '730658', '732646', '732650', '732653', '732654', '732655', '732922', '733262', '733263', '733267', '733269', '733271', '733275', '733404', '733406', '733407', '736451', '736636', '736651', '736778', '736820', '739215', '740687', '743238', '745156', '745161', '747751', '747752', '747753', '747756', '747762', '747764', '747765', '747766', '747767', '749947', '751615', '754092', '754309', '754698', '754700', '754708', '754710', '754711', '754716', '754717', '754727', '754741', '754742', '754751', '754752', '754755', '755848', '755856', '757151', '757401', '758119', '760105', '760495', '760815', '760816', '761132', '761785', '762273', '762821', '763490', '767980', '767982', '769860', '769865', '771812', '772002', '772486', '772488', '772870', '773028', '773030', '773032', '773038', '773040', '773041', '773042', '773053', '773056', '773672', '776259', '776260', '776585', '777053', '777054', '777800', '777801', '777802', '777804', '778690', '778919', '778920', '778922', '779010', '779015', '779077', '779438', '780101', '782351', '782464', '786436', '786437', '787072', '789938', '790395', '790396', '790397', '790432', '790440', '790447', '790449', '790460', '790461', '790462', '790463', '790464', '790494', '793055', '793059', '793063', '793064', '793075', '793119', '793145', '793151', '793540', '795073', '795993', '795995', '796014', '796018', '796062', '796076', '796082', '796087', '796090', '796098', '796100', '796104', '796111', '796112', '796120', '796122', '796144', '796145', '798336', '798337', '798621', '798669', '799295', '799297', '799371', '799381', '799385', '799387', '799389', '799390', '799400', '799403', '799409', '799414', '799417', '799424', '799427', '799465', '800604', '800605', '800606', '801219', '801220', '801329', '802488', '802489', '802504', '802519', '802523', '802529', '802532', '802537', '802543', '802941', '802972', '805773', '805936', '808035', '808036', '808037', '808038', '808039', '808044', '808059', '808060', '808443', '808783', '808786', '808787', '809478', '809481', '809485', '809548', '811596', '813763', '814010', '814053', '815096', '815360', '816500', '816630', '816631', '816773', '817215', '817253', '817254', '817255', '817258', '817270', '817271', '818210', '818222', '818223', '818674', '819564', '819565', '819566', '820076', '820140', '820144', '820152', '820154', '820168', '820658', '820659', '820661', '820663', '822499', '822529', '822540', '822543', '822544', '827591', '827593', '827595', '827596', '827598', '827599', '827893', '827923', '833116', '833120', '833121', '833122', '833123', '833131', '833134', '833137', '833766', '833788', '833789', '834329', '834330', '834709', '834977', '834979', '834983', '835020', '835023', '835045', '835051', '835053', '835061', '835066', '835072', '835076', '835108', '835114', '835119', '835145', '835153', '835155', '835159', '835161', '835163', '835437', '835444', '835445', '835446', '835463', '835464', '835471', '835484', '835487', '835590', '835648', '835656', '835679', '836173', '836449', '837376', '840417', '840557', '841284', '841286', '841292', '843256', '843743', '844216', '844224', '844292', '844298', '844306', '844312', '844316', '844368', '844565', '844566', '844569', '844571', '844572', '844573', '844575', '844576', '844577', '844578', '844579', '844586', '844588', '844589', '844593', '844598', '844600', '844601', '844604', '844616', '844617', '844618', '844619', '844623', '844625', '844626', '844632', '844633', '844636', '844640', '844641', '844644', '844648', '844649', '844651', '844652', '844657', '844660', '844662', '844667', '844680', '844682', '844685', '844698', '844699', '844703', '844704', '844708', '844716', '844739', '844741', '844758', '844759', '845013', '845019', '845020', '845021', '845022', '845029', '845030', '845038', '845041', '845042', '845043', '845051', '845052', '845134', '845135', '845136', '845141', '845143', '845150', '845158', '845159', '845841', '845843', '846069', '846489', '847437', '847441', '847447', '847454', '847628', '847629', '847637', '847908', '848218', '848278', '848481', '848482', '848483', '849352', '849353', '849356', '849357', '849358', '849359', '849360', '849361', '849362', '849884', '850060', '850065', '850071', '850359', '850360', '850361', '850439', '850446', '850454', '850467', '850481', '850485', '850486', '850488', '850493', '851126', '851492', '851532', '851533', '851665', '851713', '851725', '851891', '852229', '852540', '853205', '853978', '853982', '853983', '854681', '855683', '855684', '855721', '855742', '856538', '856946', '856947', '856948', '858565', '859299', '859304', '859305', '859330', '861027', '861028', '861525', '861542', '861581', '861924', '861994', '861997', '861998', '862723', '863203', '864347', '864349', '864350', '865584', '865649', '865681', '866268', '866269', '866360', '866365', '867099', '867127', '868312', '868313', '869058', '869603', '870620', '871637', '871638', '873171', '873175', '873593', '873595', '874524', '875935', '875936', '875937', '875938', '876049', '876934', '876937', '876940', '877337', '877450', '878059', '878063', '878064', '878149', '880097', '880108', '880117', '880118', '885290', '885344', '885580', '885786', '885958', '885962', '885966', '886041', '886589', '886590', '887519', '889876', '891759', '891760', '893692', '893706', '894410', '896168', '896208', '897043', '897044', '897451', '897487', '898724', '898868', '900958', '900959', '901069', '901076', '901472', '901473', '901475', '903194', '904460', '905464', '905591', '905989', '906035', '906040', '906067', '906442', '906443', '906462', '906488', '906489', '906770', '906799', '906805', '909990', '910518', '911838', '916281', '916290', '916655', '917778', '917787', '917795', '919655', '920545', '920550', '920582', '920598', '922749', '922760', '923211', '923264', '923354', '923426', '923427', '923428', '923429', '923431', '923437', '923468', '923469', '923470', '923578', '923588', '923590', '923591', '923593', '923595', '924391', '924903', '926220', '926428', '926429', '926430', '927329', '927406', '929978', '929982', '930807', '930808', '930809', '930812', '930817', '930821', '930828', '930834', '930836', '930838', '930841', '930842', '930858', '930869', '930871', '930877', '930880', '930893', '930895', '930896', '930903', '930906', '931132', '931457', '931554', '932767', '932801', '933274', '933278', '933279', '933280', '933283', '933311', '933320', '933342', '933346', '933484', '933942', '934633', '934770', '934968', '934969', '934970', '934971', '937314', '938139', '938817', '939002', '940780', '941171', '943232', '944714', '949922', '950188', '950222', '950223', '950402', '950403', '950406', '950492', '950507', '950509', '950528', '950529', '951464', '951470', '951525', '952191', '952289', '952290', '952301', '952303', '953093', '953169', '953217', '953255', '953529', '954304', '954544', '954545', '954553', '954563', '954586', '954679', '954681', '954682', '954683', '954684', '954686', '954687', '954688', '954689', '954690', '954699', '954713', '954719', '954720', '954721', '954723', '954724', '954727', '954728', '954729', '954730', '954733', '954734', '954735', '954736', '954738', '954739', '954740', '954878', '955063', '955065', '955213', '956342', '956344', '956894', '956895', '956974', '957686', '957687', '958401', '960001', '960152', '960153', '960155', '960156', '960157', '960292', '960305', '960727', '960813', '960814', '960815', '960823', '960835', '960849', '960850', '960852', '960853', '960854', '960859', '960863', '960968', '960969', '960971', '960987', '960988', '960994', '960997', '961024', '961090', '961098', '961099', '961100', '961106', '961107', '961116', '961136', '961210', '961313', '961534', '961535', '961538', '961541', '961594', '961601', '961603', '961617', '961674', '961728', '962301', '963932', '965696', '965699', '965706', '966071', '966072', '966700', '966701', '966720', '966721', '966724', '966728', '966875', '966878', '966887', '969584', '970329', '972526', '972749', '972756', '972759', '972919', '972946', '972950', '973003', '973814', '975399', '975403', '975405', '975411', '975414', '978586', '979151', '979526', '979818', '979821', '979833', '979839', '979844', '981271', '981402', '981774', '981822', '981823', '981825', '982569', '982882', '982883', '983627', '984006', '985162', '985316', '985358', '985360', '985512', '985639', '985641', '985728', '985967', '986441', '986549', '986942', '987607', '987609', '988040', '988041', '988042', '991613', '991738', '994039', '994709', '995366', '997112', '998833', '998971', '999199', '999201', '999383', '999486', '999487', '999496', '999575', '999671', '999729', '999730'
    ];

    var _opts = {
        deliveryText: 'Delivered in 2 working days',
        someProductsMatchText: '<p>Some products will be dispatched separately and delivered in 2 working days. The estimated delivery date is the latest date for delivery of <em>all</em> products.</p>'
    };

    // -------------------------------------------------
    // Entry point for running test - desktop
    // -------------------------------------------------
    function runDesktop() {
        var $ = window.jQuery;

        if($('body').hasClass('tp008c')) {
            return;
        }

        $('body').addClass('tp008 tp008c tp008-desktop');

        var itemRows = $('.baskt_items_wrap .baskt_item');

        var numProducts = 0;
        itemRows.each(function() {
            if(!$(this).find('.delivery-entry-button').length) {
                return;
            }

            numProducts++;
        });

        if(numProducts == 0) {
            return;
        }

        // Get SKUs and check that they are in our target products array
        // Only care about products that are flagged as for delivery
        var numProductsMatch = 0;
        itemRows.each(function() {
            if(!$(this).find('.delivery-entry-button').length) {
                return;
            }

            var sku = $(this).find('.item_code').text().trim();

            if(targetProducts.indexOf(sku) >= 0) {
                numProductsMatch++;
            }
        });

        if(numProductsMatch === numProducts) {
            // All products match
            changeRowDeliveryText();

            changeInfoDeliveryText();

            sendEvent('showing-test--all-products-match', 'totalProductsOnPage=' + numProducts);
        } else if(numProductsMatch > 0) {
            // Some products match
            changeRowDeliveryText();

            showAdditionalInfoMessage();

            sendEvent('showing-test--some-products-match', ('numProductsMatch=' + numProductsMatch + ';totalProductsOnPage=' + numProducts));
        } else {
            sendEvent('not-showing-test', ('totalProductsOnPage=' + numProducts));
        }

        // Show a message to say that *some* products are eligible for the delivery
        function showAdditionalInfoMessage() {
            $('.tp27_delivery-info-container .delivery-time').after([
                '<div class="tp8c-additional-info-message">',
                    _opts.someProductsMatchText,
                '</div>'
            ].join(''));
        }

        // Change delivery date in each row where delivery is chosen option
        function changeRowDeliveryText() {
            itemRows.each(function() {
                var sku = $(this).find('.item_code').text().trim();

                if(targetProducts.indexOf(sku) >= 0) {
                    var deliveryTextElm = $(this).find('.delivery-entry-button .tp27_text-node');
                    deliveryTextElm.html(_opts.deliveryText);
                }
            });
        }

        // Change delivery date in info box
        function changeInfoDeliveryText() {
            $('.tp27_delivery-info-container .delivery-time').html(_opts.deliveryText);
        }
    }
    
    // -------------------------------------------------
    // Entry point for running test - mobile
    // -------------------------------------------------
    function runMobile() {
        var $ = window.jQuery;

        if($('body').hasClass('tp008c')) {
            return;
        }

        $('body').addClass('tp008 tp008c tp008-mobile');

        var itemRows = $('.baskt_items_wrap .baskt_item');

        var numProducts = 0;
        itemRows.each(function() {
            if($(this).find('.itm_collect .content').length) {
                return;
            }

            numProducts++;
        });

        if(numProducts == 0) {
            return;
        }

        // Get SKUs and check that they are in our target products array
        // Only care about products that are flagged as for delivery
        var numProductsMatch = 0;
        itemRows.each(function() {
            if($(this).find('.itm_collect .content').length) {
                return;
            }

            var sku = $(this).find('.item_code .normal').text().trim();

            if(targetProducts.indexOf(sku) >= 0) {
                numProductsMatch++;
            }
        });

        if(numProductsMatch === numProducts) {
            // All products match
            changeRowDeliveryText();

            changeInfoDeliveryText();

            sendEvent('showing-test--all-products-match', 'totalProductsOnPage=' + numProducts);
        } else if(numProductsMatch > 0) {
            // Some products match
            changeRowDeliveryText();

            showAdditionalInfoMessage();

            sendEvent('showing-test--some-products-match', ('numProductsMatch=' + numProductsMatch + ';totalProductsOnPage=' + numProducts));
        } else {
            sendEvent('not-showing-test', ('totalProductsOnPage=' + numProducts));
        }

        // Show a message to say that *some* products are eligible for the delivery
        function showAdditionalInfoMessage() {
            $('.delivery-time').append([
                '<div class="tp8c-additional-info-message">',
                    _opts.someProductsMatchText,
                '</div>'
            ].join(''));
        }

        // Change delivery date in each row where delivery is chosen option
        function changeRowDeliveryText() {
            itemRows.each(function() {
                var sku = $(this).find('.item_code .normal').text().trim();

                if(targetProducts.indexOf(sku) >= 0) {
                    var deliveryTextElm = $(this).find('.itm_delivery > div:last');
                    deliveryTextElm.html(_opts.deliveryText);
                }
            });
        }

        // Change info delivery text
        function changeInfoDeliveryText() {
            $('.delivery-time').html(_opts.deliveryText);
        }
    }

    /**
     * Helper send GA event
     */
    var trackerName;
    function sendEvent(action, label, nonInteractionValue) {
        var category = 'TP008c---Basket-Messaging';
        label = label || '';
        var fire = function(tracker) {
            window.ga(tracker + '.send', 'event', category, action, label, {nonInteraction: nonInteractionValue});
        };

        if (trackerName) {
            fire(trackerName);
        } else {
            UC.poller([
                function() { return window.ga.getAll; }
            ], function() {
                trackerName = window.ga.getAll()[0].get('name');
                fire(trackerName);
            });
        }
    }

    // -------------------------------------------------
    // Poll required elements - desktop
    // -------------------------------------------------
    UC.poller([
        'body.page-cartPage',
        '.tp27_basket-item-content',
        '.baskt_items_wrap .baskt_item',
        '.delivery-entry-button',
        function() {
            return window.jQuery || false;
        }
    ], function() {
        runDesktop();    
    });
    
    // -------------------------------------------------
    // Poll required elements - mobile
    // -------------------------------------------------
    UC.poller([
        'body.page-mobile-cartPage',
        '.baskt_items_wrap .baskt_item',
        '.itm_delivery',
        function() {
            return window.jQuery || false;
        }
    ], function() {
        runMobile();    
    });
})();
